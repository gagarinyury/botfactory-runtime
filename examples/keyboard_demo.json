{
  "use": [
    "flow.wizard.v1",
    "action.sql_exec.v1",
    "action.sql_query.v1",
    "action.reply_template.v1"
  ],
  "intents": [
    {
      "cmd": "/start",
      "reply": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! üëã\\n–≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä –≤ DSL v1"
    }
  ],
  "flows": [
    {
      "entry_cmd": "/menu",
      "on_enter": [
        {
          "action.reply_template.v1": {
            "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
            "keyboard": [
              {"text": "üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å", "callback": "/book"},
              {"text": "üìã –ú–æ–∏ –∑–∞–ø–∏—Å–∏", "callback": "/my"},
              {"text": "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω—å", "callback": "/cancel"},
              {"text": "‚ÑπÔ∏è –ü–æ–º–æ—â—å", "callback": "/help"}
            ]
          }
        }
      ]
    },
    {
      "entry_cmd": "/book",
      "steps": [
        {
          "ask": "–ö–∞–∫—É—é —É—Å–ª—É–≥—É —Ö–æ—Ç–∏—Ç–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å?",
          "var": "service",
          "validate": {
            "regex": "^(massage|spa|consultation)$",
            "msg": "–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö: massage, spa, consultation"
          }
        },
        {
          "ask": "–ù–∞ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è? (—Ñ–æ—Ä–º–∞—Ç: YYYY-MM-DD HH:MM)",
          "var": "slot",
          "validate": {
            "regex": "^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}$",
            "msg": "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç: 2024-01-15 14:00"
          }
        }
      ],
      "on_complete": [
        {
          "action.sql_exec.v1": {
            "sql": "INSERT INTO bookings(bot_id, user_id, service, slot) VALUES(:bot_id, :user_id, :service, :slot::timestamptz)"
          }
        },
        {
          "action.reply_template.v1": {
            "text": "‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ!\\n\\nüìã –î–µ—Ç–∞–ª–∏:\\n‚Ä¢ –£—Å–ª—É–≥–∞: {{service}}\\n‚Ä¢ –í—Ä–µ–º—è: {{slot}}\\n\\n–°–ø–∞—Å–∏–±–æ –∑–∞ –≤—ã–±–æ—Ä –Ω–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞! üôè",
            "keyboard": [
              {"text": "üè† –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback": "/menu"},
              {"text": "üìã –ú–æ–∏ –∑–∞–ø–∏—Å–∏", "callback": "/my"}
            ]
          }
        }
      ]
    },
    {
      "entry_cmd": "/my",
      "on_enter": [
        {
          "action.sql_query.v1": {
            "sql": "SELECT service, slot, created_at FROM bookings WHERE bot_id=:bot_id AND user_id=:user_id ORDER BY created_at DESC LIMIT 5",
            "result_var": "bookings"
          }
        },
        {
          "action.reply_template.v1": {
            "text": "üìã –í–∞—à–∏ –∑–∞–ø–∏—Å–∏:\\n\\n{{#each bookings}}üìç {{service}} ‚Äî {{slot}}\\n{{/each}}",
            "empty_text": "–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π üòî\\n\\n–ù–∞–∂–º–∏—Ç–µ \"–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å\", —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å!",
            "keyboard": [
              {"text": "üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å", "callback": "/book"},
              {"text": "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é", "callback": "/cancel"},
              {"text": "üè† –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback": "/menu"}
            ]
          }
        }
      ]
    },
    {
      "entry_cmd": "/cancel",
      "on_enter": [
        {
          "action.sql_exec.v1": {
            "sql": "DELETE FROM bookings WHERE bot_id=:bot_id AND user_id=:user_id AND id=(SELECT id FROM bookings WHERE bot_id=:bot_id AND user_id=:user_id ORDER BY created_at DESC LIMIT 1)"
          }
        },
        {
          "action.reply_template.v1": {
            "text": "‚ùå –ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å –æ—Ç–º–µ–Ω–µ–Ω–∞\\n\\n–ß—Ç–æ –¥–µ–ª–∞–µ–º –¥–∞–ª—å—à–µ?",
            "keyboard": [
              {"text": "üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–Ω–æ–≤–æ", "callback": "/book"},
              {"text": "üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–ø–∏—Å–∏", "callback": "/my"},
              {"text": "üè† –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback": "/menu"}
            ]
          }
        }
      ]
    },
    {
      "entry_cmd": "/help",
      "on_enter": [
        {
          "action.reply_template.v1": {
            "text": "‚ÑπÔ∏è –ü–æ–º–æ—â—å –ø–æ –±–æ—Ç—É\\n\\nüîπ /menu ‚Äî –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\\nüîπ /book ‚Äî –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥—É\\nüîπ /my ‚Äî –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–ø–∏—Å–∏\\nüîπ /cancel ‚Äî –æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–ø–∏—Å—å\\n\\n–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏! üëÜ",
            "keyboard": [
              {"text": "üè† –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback": "/menu"}
            ]
          }
        }
      ]
    }
  ]
}