{
  "use": [
    "flow.wizard.v1",
    "flow.menu.v1",
    "action.sql_exec.v1",
    "action.sql_query.v1",
    "action.reply_template.v1"
  ],
  "intents": [
    {
      "cmd": "/help",
      "reply": "üîó –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\\n\\nüè† /start - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\\nüìÖ /book - –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥—É\\nüìã /survey - –ø—Ä–æ–π—Ç–∏ –∞–Ω–∫–µ—Ç—É\\nüí≥ /order - –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑\\n\\n–í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ç–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –º–µ–Ω—é!"
    }
  ],
  "flows": [
    {
      "type": "flow.menu.v1",
      "entry_cmd": "/start",
      "params": {
        "title": "üè† –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Ü–µ–Ω—Ç—Ä!\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å:",
        "options": [
          {"text": "üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥—É", "callback": "/book"},
          {"text": "üìã –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É", "callback": "/survey"},
          {"text": "üí≥ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑", "callback": "/order"},
          {"text": "‚ùì –°–ø—Ä–∞–≤–∫–∞", "callback": "/help"}
        ]
      }
    },
    {
      "type": "flow.wizard.v1",
      "entry_cmd": "/book",
      "params": {
        "steps": [
          {
            "ask": "üíÜ –í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É:\\n\\n‚Ä¢ massage - –º–∞—Å—Å–∞–∂ –∏ —Ä–µ–ª–∞–∫—Å\\n‚Ä¢ hair - –ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–∏–µ —É—Å–ª—É–≥–∏\\n‚Ä¢ cosmo - –∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è\\n‚Ä¢ nails - –º–∞–Ω–∏–∫—é—Ä –∏ –ø–µ–¥–∏–∫—é—Ä\\n\\n–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏:",
            "var": "service",
            "validate": {
              "regex": "^(massage|hair|cosmo|nails)$",
              "msg": "‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É –∏–∑ —Å–ø–∏—Å–∫–∞: massage, hair, cosmo, nails"
            }
          },
          {
            "ask": "üìÖ –£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏\\n\\n–§–æ—Ä–º–∞—Ç: –ì–ì–ì–ì-–ú–ú-–î–î –ß–ß:–ú–ú\\n–ü—Ä–∏–º–µ—Ä: 2024-12-25 14:30\\n\\n–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è:",
            "var": "slot",
            "validate": {
              "regex": "^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}$",
              "msg": "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –ì–ì–ì–ì-–ú–ú-–î–î –ß–ß:–ú–ú\\n–ü—Ä–∏–º–µ—Ä: 2024-12-25 14:30"
            }
          },
          {
            "ask": "üì± –£–∫–∞–∂–∏—Ç–µ –≤–∞—à –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω\\n\\n–§–æ—Ä–º–∞—Ç: +7XXXXXXXXXX –∏–ª–∏ 8XXXXXXXXXX\\n\\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:",
            "var": "phone",
            "validate": {
              "regex": "^(\\+7|8)\\d{10}$",
              "msg": "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: +7XXXXXXXXXX –∏–ª–∏ 8XXXXXXXXXX"
            }
          }
        ],
        "on_complete": [
          {
            "type": "action.sql_exec.v1",
            "params": {
              "sql": "INSERT INTO bookings(bot_id, user_id, service, slot, phone, created_at) VALUES(:bot_id, :user_id, :service, to_timestamp(:slot, 'YYYY-MM-DD HH24:MI'), :phone, NOW())"
            }
          },
          {
            "type": "action.reply_template.v1",
            "params": {
              "text": "‚úÖ –û—Ç–ª–∏—á–Ω–æ! –í–∞—à–∞ –∑–∞–ø–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞:\\n\\nüìã –£—Å–ª—É–≥–∞: {{service}}\\nüìÖ –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è: {{slot}}\\nüì± –¢–µ–ª–µ—Ñ–æ–Ω: {{phone}}\\n\\nüîî –ú—ã –ø–µ—Ä–µ–∑–≤–æ–Ω–∏–º –≤–∞–º –∑–∞ –¥–µ–Ω—å –¥–æ –∑–∞–ø–∏—Å–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.",
              "keyboard": [
                {"text": "üìã –ú–æ–∏ –∑–∞–ø–∏—Å–∏", "callback": "/my_bookings"},
                {"text": "üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –µ—â—ë", "callback": "/book"},
                {"text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback": "/start"}
              ]
            }
          }
        ],
        "ttl_sec": 1800
      }
    },
    {
      "type": "flow.wizard.v1",
      "entry_cmd": "/survey",
      "params": {
        "steps": [
          {
            "ask": "üë§ –ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?\\n\\n–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:",
            "var": "name"
          },
          {
            "ask": "üéÇ –°–∫–æ–ª—å–∫–æ –≤–∞–º –ª–µ—Ç?\\n\\n–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–∑—Ä–∞—Å—Ç:",
            "var": "age",
            "validate": {
              "regex": "^\\d{1,3}$",
              "msg": "‚ùå –í–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç 1 –¥–æ 999"
            }
          },
          {
            "ask": "‚≠ê –û—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –æ—Ç 1 –¥–æ 5:\\n\\n‚≠ê 1 - –æ—á–µ–Ω—å –ø–ª–æ—Ö–æ\\n‚≠ê‚≠ê 2 - –ø–ª–æ—Ö–æ\\n‚≠ê‚≠ê‚≠ê 3 - –Ω–æ—Ä–º–∞–ª—å–Ω–æ\\n‚≠ê‚≠ê‚≠ê‚≠ê 4 - —Ö–æ—Ä–æ—à–æ\\n‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5 - –æ—Ç–ª–∏—á–Ω–æ\\n\\n–í–≤–µ–¥–∏—Ç–µ –æ—Ü–µ–Ω–∫—É:",
            "var": "rating",
            "validate": {
              "regex": "^[1-5]$",
              "msg": "‚ùå –û—Ü–µ–Ω–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç 1 –¥–æ 5"
            }
          },
          {
            "ask": "üí¨ –û—Å—Ç–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ –Ω–∞—à–µ–º —Å–µ—Ä–≤–∏—Å–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):\\n\\n–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–∑—ã–≤ –∏–ª–∏ '–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å':",
            "var": "comment"
          }
        ],
        "on_complete": [
          {
            "type": "action.sql_exec.v1",
            "params": {
              "sql": "INSERT INTO surveys(bot_id, user_id, name, age, rating, comment, created_at) VALUES(:bot_id, :user_id, :name, :age, :rating, CASE WHEN :comment = '–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å' THEN NULL ELSE :comment END, NOW())"
            }
          },
          {
            "type": "action.reply_template.v1",
            "params": {
              "text": "üôè –°–ø–∞—Å–∏–±–æ, {{name}}!\\n\\nüìä –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:\\nüë§ –ò–º—è: {{name}}\\nüéÇ –í–æ–∑—Ä–∞—Å—Ç: {{age}}\\n‚≠ê –û—Ü–µ–Ω–∫–∞: {{rating}}/5\\n\\nüíù –í–∞—à–µ –º–Ω–µ–Ω–∏–µ –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ –¥–ª—è –Ω–∞—Å!",
              "keyboard": [
                {"text": "üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥—É", "callback": "/book"},
                {"text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback": "/start"}
              ]
            }
          }
        ],
        "ttl_sec": 3600
      }
    },
    {
      "type": "flow.wizard.v1",
      "entry_cmd": "/order",
      "params": {
        "steps": [
          {
            "ask": "üõçÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–∞:\\n\\n‚Ä¢ cosmetics - –∫–æ—Å–º–µ—Ç–∏–∫–∞\\n‚Ä¢ accessories - –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã\\n‚Ä¢ gift_cards - –ø–æ–¥–∞—Ä–æ—á–Ω—ã–µ –∫–∞—Ä—Ç—ã\\n\\n–í–≤–µ–¥–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:",
            "var": "category",
            "validate": {
              "regex": "^(cosmetics|accessories|gift_cards)$",
              "msg": "‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é: cosmetics, accessories, gift_cards"
            }
          },
          {
            "ask": "üì¶ –£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ (–æ—Ç 1 –¥–æ 99):\\n\\n–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:",
            "var": "quantity",
            "validate": {
              "regex": "^[1-9]\\d?$",
              "msg": "‚ùå –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 99"
            }
          },
          {
            "ask": "üè† –í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:\\n\\n–§–æ—Ä–º–∞—Ç: –ì–æ—Ä–æ–¥, –£–ª–∏—Ü–∞, –î–æ–º\\n–ü—Ä–∏–º–µ—Ä: –ú–æ—Å–∫–≤–∞, –¢–≤–µ—Ä—Å–∫–∞—è, 10\\n\\n–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å:",
            "var": "address",
            "validate": {
              "regex": ".{10,}",
              "msg": "‚ùå –ê–¥—Ä–µ—Å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤"
            }
          }
        ],
        "on_enter": [
          {
            "type": "action.reply_template.v1",
            "params": {
              "text": "üõí –ù–∞—á–∏–Ω–∞–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞!\\n\\nüìã –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π, –∏ –º—ã –æ–±—Ä–∞–±–æ—Ç–∞–µ–º –≤–∞—à –∑–∞–∫–∞–∑."
            }
          }
        ],
        "on_complete": [
          {
            "type": "action.sql_exec.v1",
            "params": {
              "sql": "INSERT INTO orders(bot_id, user_id, category, quantity, address, status, created_at) VALUES(:bot_id, :user_id, :category, :quantity, :address, 'pending', NOW())"
            }
          },
          {
            "type": "action.sql_query.v1",
            "params": {
              "sql": "SELECT id FROM orders WHERE bot_id=:bot_id AND user_id=:user_id ORDER BY created_at DESC LIMIT 1",
              "result_var": "order_info"
            }
          },
          {
            "type": "action.reply_template.v1",
            "params": {
              "text": "üéâ –ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω!\\n\\nüì¶ –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞:\\nüõçÔ∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{category}}\\nüì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {{quantity}}\\nüè† –ê–¥—Ä–µ—Å: {{address}}\\n\\n{{#each order_info}}üìã –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: #{{id}}{{/each}}\\n\\n‚è∞ –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —á–∞—Å–æ–≤ –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π.",
              "keyboard": [
                {"text": "üìã –ú–æ–∏ –∑–∞–∫–∞–∑—ã", "callback": "/my_orders"},
                {"text": "üõçÔ∏è –û—Ñ–æ—Ä–º–∏—Ç—å –µ—â—ë –∑–∞–∫–∞–∑", "callback": "/order"},
                {"text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback": "/start"}
              ]
            }
          }
        ],
        "ttl_sec": 7200
      }
    },
    {
      "entry_cmd": "/my_bookings",
      "on_enter": [
        {
          "type": "action.sql_query.v1",
          "params": {
            "sql": "SELECT service, slot, phone, created_at FROM bookings WHERE bot_id=:bot_id AND user_id=:user_id ORDER BY created_at DESC LIMIT 10",
            "result_var": "user_bookings"
          }
        },
        {
          "type": "action.reply_template.v1",
          "params": {
            "text": "üìã –í–∞—à–∏ –∑–∞–ø–∏—Å–∏:\\n\\n{{#each user_bookings}}üìç {{service}} ‚Äî {{slot}}\\nüì± {{phone}}\\nüìÖ –°–æ–∑–¥–∞–Ω–æ: {{created_at}}\\n\\n{{/each}}",
            "empty_text": "üòî –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π\\n\\n–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥—É!",
            "keyboard": [
              {"text": "üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥—É", "callback": "/book"},
              {"text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback": "/start"}
            ]
          }
        }
      ]
    }
  ]
}