{
  "use": [
    "flow.menu.v1",
    "flow.wizard.v1",
    "action.sql_exec.v1",
    "action.sql_query.v1",
    "action.reply_template.v1"
  ],
  "intents": [
    {
      "cmd": "/help",
      "reply": "‚ÑπÔ∏è –°–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É:\\n\\nüè† /start - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\\nüìÖ /book - –ø—Ä—è–º–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ\\nüìã /my - –º–æ–∏ –∑–∞–ø–∏—Å–∏\\n\\n–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ –º–µ–Ω—é!"
    }
  ],
  "flows": [
    {
      "type": "flow.menu.v1",
      "entry_cmd": "/start",
      "params": {
        "title": "üè† –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–µ—Ä–≤–∏—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è!\\n\\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        "options": [
          {"text": "üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥—É", "callback": "/book"},
          {"text": "üìã –ú–æ–∏ –∑–∞–ø–∏—Å–∏", "callback": "/my"},
          {"text": "üîç –í—ã–±—Ä–∞—Ç—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏", "callback": "/categories"},
          {"text": "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏", "callback": "/settings"},
          {"text": "‚ùì –°–ø—Ä–∞–≤–∫–∞", "callback": "/help"}
        ]
      }
    },
    {
      "type": "flow.menu.v1",
      "entry_cmd": "/categories",
      "params": {
        "title": "üîç –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —É—Å–ª—É–≥:",
        "options": [
          {"text": "üíÜ –ú–∞—Å—Å–∞–∂ –∏ —Ä–µ–ª–∞–∫—Å", "callback": "category_massage"},
          {"text": "üíá –ü–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–∏–µ —É—Å–ª—É–≥–∏", "callback": "category_hair"},
          {"text": "‚ú® –ö–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è", "callback": "category_cosmo"},
          {"text": "üíÖ –ú–∞–Ω–∏–∫—é—Ä –∏ –ø–µ–¥–∏–∫—é—Ä", "callback": "category_nails"},
          {"text": "üîô –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback": "/start"}
        ]
      }
    },
    {
      "type": "flow.menu.v1",
      "entry_cmd": "/settings",
      "params": {
        "title": "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:",
        "options": [
          {"text": "üåç –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞", "callback": "setting_language"},
          {"text": "üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è", "callback": "setting_notifications"},
          {"text": "üë§ –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ", "callback": "setting_profile"},
          {"text": "üïí –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å", "callback": "setting_timezone"},
          {"text": "üîô –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback": "/start"}
        ]
      }
    },
    {
      "entry_cmd": "/book",
      "steps": [
        {
          "ask": "üíÜ –ö–∞–∫—É—é —É—Å–ª—É–≥—É —Ö–æ—Ç–∏—Ç–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å?\\n\\n–î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:\\n- massage (–º–∞—Å—Å–∞–∂)\\n- hair (–ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä)\\n- cosmo (–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∏—è)\\n- nails (–º–∞–Ω–∏–∫—é—Ä)",
          "var": "service",
          "validate": {
            "regex": "^(massage|hair|cosmo|nails)$",
            "msg": "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö: massage, hair, cosmo, nails"
          }
        },
        {
          "ask": "üìÖ –ù–∞ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∞—Ç—å—Å—è?\\n\\n–§–æ—Ä–º–∞—Ç: –ì–ì–ì–ì-–ú–ú-–î–î –ß–ß:–ú–ú\\n–ü—Ä–∏–º–µ—Ä: 2024-12-25 14:00",
          "var": "slot",
          "validate": {
            "regex": "^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}$",
            "msg": "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –ì–ì–ì–ì-–ú–ú-–î–î –ß–ß:–ú–ú\\n–ü—Ä–∏–º–µ—Ä: 2024-12-25 14:00"
          }
        }
      ],
      "on_complete": [
        {
          "action.sql_exec.v1": {
            "sql": "INSERT INTO bookings(bot_id, user_id, service, slot, created_at) VALUES(:bot_id, :user_id, :service, :slot::timestamptz, NOW())"
          }
        },
        {
          "action.reply_template.v1": {
            "text": "‚úÖ –û—Ç–ª–∏—á–Ω–æ! –í–∞—à–∞ –∑–∞–ø–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞:\\n\\nüìã –£—Å–ª—É–≥–∞: {{service}}\\nüìÖ –í—Ä–µ–º—è: {{slot}}\\n\\nüéâ –ñ–¥—ë–º –≤–∞—Å –≤ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è!",
            "keyboard": [
              {"text": "üìã –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–æ–∏ –∑–∞–ø–∏—Å–∏", "callback": "/my"},
              {"text": "üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –µ—â—ë", "callback": "/book"},
              {"text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback": "/start"}
            ]
          }
        }
      ]
    },
    {
      "entry_cmd": "/my",
      "on_enter": [
        {
          "action.sql_query.v1": {
            "sql": "SELECT service, slot, created_at FROM bookings WHERE bot_id=:bot_id AND user_id=:user_id ORDER BY created_at DESC LIMIT 5",
            "result_var": "bookings"
          }
        },
        {
          "action.reply_template.v1": {
            "text": "üìã –í–∞—à–∏ –∑–∞–ø–∏—Å–∏:\\n\\n{{#each bookings}}üìç {{service}} ‚Äî {{slot}}\\n{{/each}}",
            "empty_text": "üòî –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π\\n\\n–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–≤—É—é —É—Å–ª—É–≥—É!",
            "keyboard": [
              {"text": "üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥—É", "callback": "/book"},
              {"text": "üîç –í—ã–±—Ä–∞—Ç—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏", "callback": "/categories"},
              {"text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback": "/start"}
            ]
          }
        }
      ]
    }
  ]
}